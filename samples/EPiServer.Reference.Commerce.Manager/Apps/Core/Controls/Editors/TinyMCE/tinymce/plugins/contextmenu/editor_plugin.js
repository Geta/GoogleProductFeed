(function(){var a=tinymce.dom.Event,c=tinymce.each,b=tinymce.DOM;tinymce.create("tinymce.plugins.ContextMenu",{init:function(g){var f=this,e;f.editor=g;f.onContextMenu=new tinymce.util.Dispatcher(this);g.onContextMenu.add(function(h,i){if(!i.ctrlKey){if(e){h.selection.setRng(e);}f._getMenu(h).showMenu(i.clientX,i.clientY);a.add(h.getDoc(),"click",function(j){d(h,j);});a.cancel(i);}});g.onRemove.add(function(){if(f._menu){f._menu.removeAll();}});function d(h,i){e=null;if(i&&i.button==2){e=h.selection.getRng();return;}if(f._menu){f._menu.removeAll();f._menu.destroy();a.remove(h.getDoc(),"click",d);}}g.onMouseDown.add(d);g.onKeyDown.add(d);},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:tinymce.majorVersion+"."+tinymce.minorVersion};},_getMenu:function(e){var l=this,g=l._menu,f=e.selection,d=f.isCollapsed(),k=f.getNode()||e.getBody(),h,i,j;if(g){g.removeAll();g.destroy();}i=b.getPos(e.getContentAreaContainer());j=b.getPos(e.getContainer());g=e.controlManager.createDropMenu("contextmenu",{offset_x:i.x+e.getParam("contextmenu_offset_x",0),offset_y:i.y+e.getParam("contextmenu_offset_y",0),constrain:1});l._menu=g;g.add({title:"advanced.cut_desc",icon:"cut",cmd:"Cut"}).setDisabled(d);g.add({title:"advanced.copy_desc",icon:"copy",cmd:"Copy"}).setDisabled(d);g.add({title:"advanced.paste_desc",icon:"paste",cmd:"Paste"});if((k.nodeName=="A"&&!e.dom.getAttrib(k,"name"))||!d){g.addSeparator();g.add({title:"advanced.link_desc",icon:"link",cmd:e.plugins.advlink?"mceAdvLink":"mceLink",ui:true});g.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});}g.addSeparator();g.add({title:"advanced.image_desc",icon:"image",cmd:e.plugins.advimage?"mceAdvImage":"mceImage",ui:true});g.addSeparator();h=g.addMenu({title:"contextmenu.align"});h.add({title:"contextmenu.left",icon:"justifyleft",cmd:"JustifyLeft"});h.add({title:"contextmenu.center",icon:"justifycenter",cmd:"JustifyCenter"});h.add({title:"contextmenu.right",icon:"justifyright",cmd:"JustifyRight"});h.add({title:"contextmenu.full",icon:"justifyfull",cmd:"JustifyFull"});l.onContextMenu.dispatch(l,g,k,d);return g;}});tinymce.PluginManager.add("contextmenu",tinymce.plugins.ContextMenu);})();