(function(){var a=tinymce.each;tinymce.create("tinymce.plugins.TemplatePlugin",{init:function(d,b){var c=this;c.editor=d;d.addCommand("mceTemplate",function(e){d.windowManager.open({file:b+"/template.htm",width:d.getParam("template_popup_width",750),height:d.getParam("template_popup_height",600),inline:1},{plugin_url:b});});d.addCommand("mceInsertTemplate",c._insertTemplate,c);d.addButton("template",{title:"template.desc",cmd:"mceTemplate"});d.onPreProcess.add(function(g,e){var f=g.dom;a(f.select("div",e.node),function(h){if(f.hasClass(h,"mceTmpl")){a(f.select("*",h),function(i){if(f.hasClass(i,g.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){i.innerHTML=c._getDateTime(new Date(),g.getParam("template_mdate_format",g.getLang("template.mdate_format")));}});c._replaceVals(h);}});});},getInfo:function(){return{longname:"Template plugin",author:"Moxiecode Systems AB",authorurl:"http://www.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/template",version:tinymce.majorVersion+"."+tinymce.minorVersion};},_insertTemplate:function(f,j){var i=this,c=i.editor,b,g,d=c.dom,e=c.selection.getContent();b=j.content;a(i.editor.getParam("template_replace_values"),function(l,h){if(typeof(l)!="function"){b=b.replace(new RegExp("\\{\\$"+h+"\\}","g"),l);}});g=d.create("div",null,b);n=d.select(".mceTmpl",g);if(n&&n.length>0){g=d.create("div",null);g.appendChild(n[0].cloneNode(true));}function k(h,l){return new RegExp("\\b"+l+"\\b","g").test(h.className);}a(d.select("*",g),function(h){if(k(h,c.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))){h.innerHTML=i._getDateTime(new Date(),c.getParam("template_cdate_format",c.getLang("template.cdate_format")));}if(k(h,c.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){h.innerHTML=i._getDateTime(new Date(),c.getParam("template_mdate_format",c.getLang("template.mdate_format")));}if(k(h,c.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))){h.innerHTML=e;}});i._replaceVals(g);c.execCommand("mceInsertContent",false,g.innerHTML);c.addVisual();},_replaceVals:function(c){var d=this.editor.dom,b=this.editor.getParam("template_replace_values");a(d.select("*",c),function(f){a(b,function(g,e){if(d.hasClass(f,e)){if(typeof(b[e])=="function"){b[e](f);}}});});},_getDateTime:function(e,b){if(!b){return"";}function c(d,g){var f;d=""+d;if(d.length<g){for(f=0;f<(g-d.length);f++){d="0"+d;}}return d;}b=b.replace("%D","%m/%d/%y");b=b.replace("%r","%I:%M:%S %p");b=b.replace("%Y",""+e.getFullYear());b=b.replace("%y",""+e.getYear());b=b.replace("%m",c(e.getMonth()+1,2));b=b.replace("%d",c(e.getDate(),2));b=b.replace("%H",""+c(e.getHours(),2));b=b.replace("%M",""+c(e.getMinutes(),2));b=b.replace("%S",""+c(e.getSeconds(),2));b=b.replace("%I",""+((e.getHours()+11)%12+1));b=b.replace("%p",""+(e.getHours()<12?"AM":"PM"));b=b.replace("%B",""+this.editor.getLang("template_months_long").split(",")[e.getMonth()]);b=b.replace("%b",""+this.editor.getLang("template_months_short").split(",")[e.getMonth()]);b=b.replace("%A",""+this.editor.getLang("template_day_long").split(",")[e.getDay()]);b=b.replace("%a",""+this.editor.getLang("template_day_short").split(",")[e.getDay()]);b=b.replace("%%","%");return b;}});tinymce.PluginManager.add("template",tinymce.plugins.TemplatePlugin);})();