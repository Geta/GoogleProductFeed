(function(a){var d=a.each;function b(j,h){var g=h.ownerDocument,e=g.createRange(),f;e.setStartBefore(h);e.setEnd(j.endContainer,j.endOffset);f=g.createElement("body");f.appendChild(e.cloneContents());return f.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0;}function c(s,I,F){var f,J,t,m;h();m=I.getParent(F.getStart(),"th,td");if(m){J=u(m);t=B();m=C(J.x,J.y);}function l(L,M){L=L.cloneNode(M);L.removeAttribute("id");return L;}function h(){var L=0;f=[];d(["thead","tbody","tfoot"],function(M){var N=I.select("> "+M+" tr",s);d(N,function(P,O){O+=L;d(I.select("> td, > th",P),function(S,Q){var R,T,U,V;if(f[O]){while(f[O][Q]){Q++;}}U=z(S,"rowspan");V=z(S,"colspan");for(T=O;T<O+U;T++){if(!f[T]){f[T]=[];}for(R=Q;R<Q+V;R++){f[T][R]={part:M,real:T==O&&R==Q,elm:S,rowspan:U,colspan:V};}}});});L+=N.length;});}function C(M,N){var L;L=f[N];if(L){return L[M];}}function z(M,L){return parseInt(M.getAttribute(L)||1);}function e(L){return I.hasClass(L.elm,"mceSelected")||L==m;}function w(){var L=[];d(s.rows,function(M){d(M.cells,function(N){if(I.hasClass(N,"mceSelected")||N==m.elm){L.push(M);return false;}});});return L;}function p(){var L=I.createRng();L.setStartAfter(s);L.setEndAfter(s);F.setRng(L);I.remove(s);}function g(M){var L;a.walk(M,function(N){var O;if(N.nodeType==3){d(I.getParents(N.parentNode,null,M).reverse(),function(P){P=l(P,false);if(!L){L=O=P;}else{if(O){O.appendChild(P);}}O=P;});if(O){O.innerHTML=a.isIE?"&nbsp;":'<br _mce_bogus="1" />';}return false;}},"childNodes");M=l(M,false);M.rowSpan=M.colSpan=1;if(L){M.appendChild(L);}else{if(!a.isIE){M.innerHTML='<br _mce_bogus="1" />';}}return M;}function H(){var L=I.createRng();d(I.select("tr",s),function(M){if(M.cells.length==0){I.remove(M);}});if(I.select("tr",s).length==0){L.setStartAfter(s);L.setEndAfter(s);F.setRng(L);I.remove(s);return;}d(I.select("thead,tbody,tfoot",s),function(M){if(M.rows.length==0){I.remove(M);}});h();row=f[Math.min(f.length-1,J.y)];if(row){F.select(row[Math.min(row.length-1,J.x)].elm,true);F.collapse(true);}}function G(L,M,T,P){var N,O,Q,R,S;N=f[M][L].elm.parentNode;for(Q=1;Q<=T;Q++){N=I.getNext(N,"tr");if(N){for(O=L;O>=0;O--){S=f[M+Q][O].elm;if(S.parentNode==N){for(R=1;R<=P;R++){I.insertAfter(g(S),S);}break;}}if(O==-1){for(R=1;R<=P;R++){N.insertBefore(g(N.cells[0]),N.cells[0]);}}}}}function v(){d(f,function(L,M){d(L,function(S,O){var Q,N,R,P;if(e(S)){S=S.elm;Q=z(S,"colspan");N=z(S,"rowspan");if(Q>1||N>1){S.colSpan=S.rowSpan=1;for(P=0;P<Q-1;P++){I.insertAfter(g(S),S);}G(O,M,N-1,Q);}}});});}function o(U,S,W){var Q,P,L,O,M,N,R,T,U,V;if(U){pos=u(U);Q=pos.x;P=pos.y;L=Q+(S-1);O=P+(W-1);}else{Q=J.x;P=J.y;L=t.x;O=t.y;}R=C(Q,P);T=C(L,O);if(R&&T&&R.part==T.part){v();h();R=C(Q,P).elm;R.colSpan=(L-Q)+1;R.rowSpan=(O-P)+1;for(N=P;N<=O;N++){for(M=Q;M<=L;M++){U=f[N][M].elm;if(U!=R){V=a.grep(U.childNodes);d(V,function(X,Y){if(X.nodeName!="BR"||Y!=V.length-1){R.appendChild(X);}});I.remove(U);}}}H();}}function j(S){var O,T,N,M,Q,R,P,L;d(f,function(U,V){d(U,function(X,W){if(e(X)){X=X.elm;Q=X.parentNode;R=l(Q,false);O=V;if(S){return false;}}});if(S){return !O;}});for(M=0;M<f[0].length;M++){T=f[O][M].elm;if(T!=N){if(!S){rowSpan=z(T,"rowspan");if(rowSpan>1){T.rowSpan=rowSpan+1;continue;}}else{if(O>0&&f[O-1][M]){L=f[O-1][M].elm;rowSpan=z(L,"rowspan");if(rowSpan>1){L.rowSpan=rowSpan+1;continue;}}}P=g(T);P.colSpan=T.colSpan;R.appendChild(P);N=T;}}if(R.hasChildNodes()){if(!S){I.insertAfter(R,Q);}else{Q.parentNode.insertBefore(R,Q);}}}function A(M){var N,L;d(f,function(O,P){d(O,function(R,Q){if(e(R)){N=Q;if(M){return false;}}});if(M){return !N;}});d(f,function(O,S){var R=O[N].elm,Q,P;if(R!=L){P=z(R,"colspan");Q=z(R,"rowspan");if(P==1){if(!M){I.insertAfter(g(R),R);G(N,S,Q-1,P);}else{R.parentNode.insertBefore(g(R),R);G(N,S,Q-1,P);}}else{R.colSpan++;}L=R;}});}function r(){var L=[];d(f,function(M,N){d(M,function(P,O){if(e(P)&&a.inArray(L,O)===-1){d(f,function(Q){var S=Q[O].elm,R;R=z(S,"colspan");if(R>1){S.colSpan=R-1;}else{I.remove(S);}});L.push(O);}});});H();}function q(){var M;function L(P){var Q,O,N;Q=I.getNext(P,"tr");d(P.cells,function(S){var R=z(S,"rowspan");if(R>1){S.rowSpan=R-1;O=u(S);G(O.x,O.y,1,1);}});O=u(P.cells[0]);d(f[O.y],function(S){var R;S=S.elm;if(S!=N){R=z(S,"rowspan");if(R<=1){I.remove(S);}else{S.rowSpan=R-1;}N=S;}});}M=w();d(M.reverse(),function(N){L(N);});H();}function n(){var L=w();I.remove(L);H();return L;}function D(){var L=w();d(L,function(M,N){L[N]=l(M,true);});return L;}function k(P,O){var L=w(),N=L[O?0:L.length-1],M=N.cells.length;d(f,function(Q){var R;M=0;d(Q,function(T,S){if(T.real){M+=T.colspan;}if(T.elm.parentNode==N){R=1;}});if(R){return false;}});if(!O){P.reverse();}d(P,function(Q){var R=Q.cells.length,S;for(i=0;i<R;i++){S=Q.cells[i];S.colSpan=S.rowSpan=1;}for(i=R;i<M;i++){Q.appendChild(g(Q.cells[R-1]));}for(i=M;i<R;i++){I.remove(Q.cells[i]);}if(O){N.parentNode.insertBefore(Q,N);}else{I.insertAfter(Q,N);}});}function u(M){var L;d(f,function(N,O){d(N,function(Q,P){if(Q.elm==M){L={x:P,y:O};return false;}});return !L;});return L;}function E(L){J=u(L);}function B(){var L,M,N;M=N=0;d(f,function(O,P){d(O,function(T,S){var Q,R;if(e(T)){T=f[P][S];if(S>M){M=S;}if(P>N){N=P;}if(T.real){Q=T.colspan-1;R=T.rowspan-1;if(Q){if(S+Q>M){M=S+Q;}}if(R){if(P+R>N){N=P+R;}}}}});});return{x:M,y:N};}function K(S){var M,P,Q,R,O,T,L,N;t=u(S);if(J&&t){M=Math.min(J.x,t.x);P=Math.min(J.y,t.y);Q=Math.max(J.x,t.x);R=Math.max(J.y,t.y);O=Q;T=R;for(y=P;y<=T;y++){S=f[y][M];if(!S.real){if(M-(S.colspan-1)<M){M-=S.colspan-1;}}}for(x=M;x<=O;x++){S=f[P][x];if(!S.real){if(P-(S.rowspan-1)<P){P-=S.rowspan-1;}}}for(y=P;y<=R;y++){for(x=M;x<=Q;x++){S=f[y][x];if(S.real){L=S.colspan-1;N=S.rowspan-1;if(L){if(x+L>O){O=x+L;}}if(N){if(y+N>T){T=y+N;}}}}}I.removeClass(I.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=P;y<=T;y++){for(x=M;x<=O;x++){I.addClass(f[y][x].elm,"mceSelected");}}}}a.extend(this,{deleteTable:p,split:v,merge:o,insertRow:j,insertCol:A,deleteCols:r,deleteRows:q,cutRows:n,copyRows:D,pasteRows:k,getPos:u,setStartCell:E,setEndCell:K});}a.create("tinymce.plugins.TablePlugin",{init:function(f,g){var e,h;function k(m){var l=f.selection,n=f.dom.getParent(m||l.getNode(),"table");if(n){return new c(n,f.dom,l);}}function j(){f.getBody().style.webkitUserSelect="";f.dom.removeClass(f.dom.select("td.mceSelected,th.mceSelected"),"mceSelected");}d([["table","table.desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc","mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true]],function(l){f.addButton(l[0],{title:l[1],cmd:l[2],ui:l[3]});});if(!a.isIE){f.onClick.add(function(l,m){m=m.target;if(m.nodeName==="TABLE"){l.selection.select(m);}});}f.onNodeChange.add(function(q,o,m){var l;m=q.selection.getStart();l=q.dom.getParent(m,"td,th,caption");o.setActive("table",m.nodeName==="TABLE"||!!l);if(l&&l.nodeName==="CAPTION"){l=0;}o.setDisabled("delete_table",!l);o.setDisabled("delete_col",!l);o.setDisabled("delete_table",!l);o.setDisabled("delete_row",!l);o.setDisabled("col_after",!l);o.setDisabled("col_before",!l);o.setDisabled("row_after",!l);o.setDisabled("row_before",!l);o.setDisabled("row_props",!l);o.setDisabled("cell_props",!l);o.setDisabled("split_cells",!l);o.setDisabled("merge_cells",!l);});f.onInit.add(function(m){var l,n,o=m.dom,q;e=m.windowManager;m.onMouseDown.add(function(r,s){if(s.button!=2){j();n=o.getParent(s.target,"td,th");l=o.getParent(n,"table");}});o.bind(m.getDoc(),"mouseover",function(u){var s,t,r=u.target;if(n&&(q||r!=n)&&(r.nodeName=="TD"||r.nodeName=="TH")){t=o.getParent(r,"table");if(t==l){if(!q){q=k(t);q.setStartCell(n);m.getBody().style.webkitUserSelect="none";}q.setEndCell(r);}s=m.selection.getSel();if(s.removeAllRanges){s.removeAllRanges();}else{s.empty();}u.preventDefault();}});m.onMouseUp.add(function(u,A){var s,v=u.selection,t,D=v.getSel(),C,B,r,z;if(n){if(q){u.getBody().style.webkitUserSelect="";}function w(F,G){var E=new a.dom.TreeWalker(F,F);do{if(F.nodeType==3&&a.trim(F.nodeValue).length!=0){if(G){s.setStart(F,0);}else{s.setEnd(F,F.nodeValue.length);}return;}if(F.nodeName=="BR"){if(G){s.setStartBefore(F);}else{s.setEndBefore(F);}return;}}while(F=(G?E.next():E.prev()));}t=o.select("td.mceSelected,th.mceSelected");if(t.length>0){s=o.createRng();B=t[0];z=t[t.length-1];w(B,1);C=new a.dom.TreeWalker(B,o.getParent(t[0],"table"));do{if(B.nodeName=="TD"||B.nodeName=="TH"){if(!o.hasClass(B,"mceSelected")){break;}r=B;}}while(B=C.next());w(r);v.setRng(s);}u.nodeChanged();n=q=l=null;}});m.onKeyUp.add(function(r,s){j();});if(m&&m.plugins.contextmenu){m.plugins.contextmenu.onContextMenu.add(function(t,s,v){var u,r=m.selection,w=r.getNode()||m.getBody();if(m.dom.getParent(v,"td")||m.dom.getParent(v,"th")||m.dom.select("td.mceSelected,th.mceSelected").length){s.removeAll();if(w.nodeName=="A"&&!m.dom.getAttrib(w,"name")){s.add({title:"advanced.link_desc",icon:"link",cmd:m.plugins.advlink?"mceAdvLink":"mceLink",ui:true});s.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});s.addSeparator();}if(w.nodeName=="IMG"&&w.className.indexOf("mceItem")==-1){s.add({title:"advanced.image_desc",icon:"image",cmd:m.plugins.advimage?"mceAdvImage":"mceImage",ui:true});s.addSeparator();}s.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}});s.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"});s.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"});s.addSeparator();u=s.addMenu({title:"table.cell"});u.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"});u.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"});u.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"});u=s.addMenu({title:"table.row"});u.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"});u.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});u.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});u.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});u.addSeparator();u.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});u.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});u.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!h);u.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!h);u=s.addMenu({title:"table.col"});u.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});u.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});u.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"});}else{s.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"});}});}if(!a.isIE){function p(){var r;for(r=m.getBody().lastChild;r&&r.nodeType==3&&!r.nodeValue.length;r=r.previousSibling){}if(r&&r.nodeName=="TABLE"){m.dom.add(m.getBody(),"p",null,'<br mce_bogus="1" />');}}if(a.isGecko){m.onKeyDown.add(function(t,v){var r,u,s=t.dom;if(v.keyCode==37||v.keyCode==38){r=t.selection.getRng();u=s.getParent(r.startContainer,"table");if(u&&t.getBody().firstChild==u){if(b(r,u)){r=s.createRng();r.setStartBefore(u);r.setEndBefore(u);t.selection.setRng(r);v.preventDefault();}}}});}m.onKeyUp.add(p);m.onSetContent.add(p);m.onVisualAid.add(p);m.onPreProcess.add(function(t,r){var s=r.node.lastChild;if(s&&s.childNodes.length==1&&s.firstChild.nodeName=="BR"){t.dom.remove(s);}});p();}});d({mceTableSplitCells:function(l){l.split();},mceTableMergeCells:function(l){var n,o,m;m=f.dom.getParent(f.selection.getNode(),"th,td");if(m){n=m.rowSpan;o=m.colSpan;}if(!f.dom.select("td.mceSelected,th.mceSelected").length){e.open({url:g+"/merge_cells.htm",width:240+parseInt(f.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(f.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:n,cols:o,onaction:function(p){l.merge(m,p.cols,p.rows);},plugin_url:g});}else{l.merge();}},mceTableInsertRowBefore:function(l){l.insertRow(true);},mceTableInsertRowAfter:function(l){l.insertRow();},mceTableInsertColBefore:function(l){l.insertCol(true);},mceTableInsertColAfter:function(l){l.insertCol();},mceTableDeleteCol:function(l){l.deleteCols();},mceTableDeleteRow:function(l){l.deleteRows();},mceTableCutRow:function(l){h=l.cutRows();},mceTableCopyRow:function(l){h=l.copyRows();},mceTablePasteRowBefore:function(l){l.pasteRows(h,true);},mceTablePasteRowAfter:function(l){l.pasteRows(h);},mceTableDelete:function(l){l.deleteTable();}},function(l,m){f.addCommand(m,function(){var n=k();if(n){l(n);f.execCommand("mceRepaint");j();}});});d({mceInsertTable:function(l){e.open({url:g+"/table.htm",width:400+parseInt(f.getLang("table.table_delta_width",0)),height:320+parseInt(f.getLang("table.table_delta_height",0)),inline:1},{plugin_url:g,action:l?l.action:0});},mceTableRowProps:function(){e.open({url:g+"/row.htm",width:400+parseInt(f.getLang("table.rowprops_delta_width",0)),height:295+parseInt(f.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:g});},mceTableCellProps:function(){e.open({url:g+"/cell.htm",width:400+parseInt(f.getLang("table.cellprops_delta_width",0)),height:295+parseInt(f.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:g});}},function(l,m){f.addCommand(m,function(n,o){l(o);});});}});a.PluginManager.add("table",a.plugins.TablePlugin);})(tinymce);