(function(){var d=tinymce.DOM,c=tinymce.dom.Element,b=tinymce.dom.Event,e=tinymce.each,a=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(f,g){f.onBeforeRenderUI.add(function(){f.windowManager=new tinymce.InlineWindowManager(f);d.loadCSS(g+"/skins/"+(f.settings.inlinepopups_skin||"clearlooks2")+"/window.css");});},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion};}});tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(f){var g=this;g.parent(f);g.zIndex=300000;g.count=0;g.windows={};},open:function(v,k){var m=this,q,g="",y=m.editor,s=0,h=0,r,j,i,l,x,o,n;v=v||{};k=k||{};if(!v.inline){return m.parent(v,k);}if(!v.type){m.bookmark=y.selection.getBookmark(1);}q=d.uniqueId();r=d.getViewPort();v.width=parseInt(v.width||320);v.height=parseInt(v.height||240)+(tinymce.isIE?8:0);v.min_width=parseInt(v.min_width||150);v.min_height=parseInt(v.min_height||100);v.max_width=parseInt(v.max_width||2000);v.max_height=parseInt(v.max_height||2000);v.left=v.left||Math.round(Math.max(r.x,r.x+(r.w/2)-(v.width/2)));v.top=v.top||Math.round(Math.max(r.y,r.y+(r.h/2)-(v.height/2)));v.movable=v.resizable=true;k.mce_width=v.width;k.mce_height=v.height;k.mce_inline=true;k.mce_window_id=q;k.mce_auto_focus=v.auto_focus;m.features=v;m.params=k;m.onOpen.dispatch(m,v,k);if(v.type){g+=" mceModal";if(v.type){g+=" mce"+v.type.substring(0,1).toUpperCase()+v.type.substring(1);}v.resizable=false;}if(v.statusbar){g+=" mceStatusbar";}if(v.resizable){g+=" mceResizable";}if(v.minimizable){g+=" mceMinimizable";}if(v.maximizable){g+=" mceMaximizable";}if(v.movable){g+=" mceMovable";}m._addAll(d.doc.body,["div",{id:q,"class":(y.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:q+"_wrapper","class":"mceWrapper"+g},["div",{id:q+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:q+"_title"},v.title||""]],["div",{id:q+"_middle","class":"mceMiddle"},["div",{id:q+"_left","class":"mceLeft"}],["span",{id:q+"_content"}],["div",{id:q+"_right","class":"mceRight"}]],["div",{id:q+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:q+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:q+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:q+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:q+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:q+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:q+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:q+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:q+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:q+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]);d.setStyles(q,{top:-10000,left:-10000});if(tinymce.isGecko){d.setStyle(q,"overflow","auto");}if(!v.type){s+=d.get(q+"_left").clientWidth;s+=d.get(q+"_right").clientWidth;h+=d.get(q+"_top").clientHeight;h+=d.get(q+"_bottom").clientHeight;}d.setStyles(q,{top:v.top,left:v.left,width:v.width+s,height:v.height+h});n=v.url||v.file;if(n){if(tinymce.relaxedDomain){n+=(n.indexOf("?")==-1?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain;}n=tinymce._addVer(n);}if(!v.type){d.add(q+"_content","iframe",{id:q+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"});d.setStyles(q+"_ifr",{width:v.width,height:v.height});d.setAttrib(q+"_ifr","src",n);}else{d.add(q+"_wrapper","a",{id:q+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok");if(v.type=="confirm"){d.add(q+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel");}d.add(q+"_middle","div",{"class":"mceIcon"});d.setHTML(q+"_content",v.content.replace("\n","<br />"));}i=b.add(q,"mousedown",function(u){var t=u.target,p,f;p=m.windows[q];m.focus(q);if(t.nodeName=="A"||t.nodeName=="a"){if(t.className=="mceMax"){p.oldPos=p.element.getXY();p.oldSize=p.element.getSize();f=d.getViewPort();f.w-=2;f.h-=2;p.element.moveTo(f.x,f.y);p.element.resizeTo(f.w,f.h);d.setStyles(q+"_ifr",{width:f.w-p.deltaWidth,height:f.h-p.deltaHeight});d.addClass(q+"_wrapper","mceMaximized");}else{if(t.className=="mceMed"){p.element.moveTo(p.oldPos.x,p.oldPos.y);p.element.resizeTo(p.oldSize.w,p.oldSize.h);p.iframeElement.resizeTo(p.oldSize.w-p.deltaWidth,p.oldSize.h-p.deltaHeight);d.removeClass(q+"_wrapper","mceMaximized");}else{if(t.className=="mceMove"){return m._startDrag(q,u,t.className);}else{if(d.hasClass(t,"mceResize")){return m._startDrag(q,u,t.className.substring(13));}}}}}});l=b.add(q,"click",function(p){var f=p.target;m.focus(q);if(f.nodeName=="A"||f.nodeName=="a"){switch(f.className){case"mceClose":m.close(null,q);return b.cancel(p);case"mceButton mceOk":case"mceButton mceCancel":v.button_func(f.className=="mceButton mceOk");return b.cancel(p);}}});o=m.windows[q]={id:q,mousedown_func:i,click_func:l,element:new c(q,{blocker:1,container:y.getContainer()}),iframeElement:new c(q+"_ifr"),features:v,deltaWidth:s,deltaHeight:h};o.iframeElement.on("focus",function(){m.focus(q);});if(m.count==0&&m.editor.getParam("dialog_type","modal")=="modal"){d.add(d.doc.body,"div",{id:"mceModalBlocker","class":(m.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:m.zIndex-1}});d.show("mceModalBlocker");}else{d.setStyle("mceModalBlocker","z-index",m.zIndex-1);}if(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||(tinymce.isIE&&!d.boxModel)){d.setStyles("mceModalBlocker",{position:"absolute",left:r.x,top:r.y,width:r.w-2,height:r.h-2});}m.focus(q);m._fixIELayout(q,1);if(d.get(q+"_ok")){d.get(q+"_ok").focus();}m.count++;return o;},focus:function(f){var g=this,h;if(h=g.windows[f]){h.zIndex=this.zIndex++;h.element.setStyle("zIndex",h.zIndex);h.element.update();f=f+"_wrapper";d.removeClass(g.lastId,"mceFocus");d.addClass(f,"mceFocus");g.lastId=f;}},_addAll:function(g,l){var f,j,k=this,h=tinymce.DOM;if(a(l,"string")){g.appendChild(h.doc.createTextNode(l));}else{if(l.length){g=g.appendChild(h.create(l[0],l[1]));for(f=2;f<l.length;f++){k._addAll(g,l[f]);}}}},_startDrag:function(z,C,y){var n=this,i,h,v=d.doc,s,q=n.windows[z],F=q.element,D=F.getXY(),l,k,f,o,B,A,G,u,x,j,m,E,g;o={x:0,y:0};B=d.getViewPort();B.w-=2;B.h-=2;u=C.screenX;x=C.screenY;j=m=E=g=0;i=b.add(v,"mouseup",function(p){b.remove(v,"mouseup",i);b.remove(v,"mousemove",h);if(s){s.remove();}F.moveBy(j,m);F.resizeBy(E,g);k=F.getSize();d.setStyles(z+"_ifr",{width:k.w-q.deltaWidth,height:k.h-q.deltaHeight});n._fixIELayout(z,1);return b.cancel(p);});if(y!="Move"){r();}function r(){if(s){return;}n._fixIELayout(z,0);d.add(v.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(n.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:n.zIndex+1}});if(tinymce.isIE6||(tinymce.isIE&&!d.boxModel)){d.setStyles("mceEventBlocker",{position:"absolute",left:B.x,top:B.y,width:B.w-2,height:B.h-2});}s=new c("mceEventBlocker");s.update();l=F.getXY();k=F.getSize();A=o.x+l.x-B.x;G=o.y+l.y-B.y;d.add(s.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:A,top:G,width:k.w,height:k.h}});f=new c("mcePlaceHolder");}h=b.add(v,"mousemove",function(H){var w,t,p;r();w=H.screenX-u;t=H.screenY-x;switch(y){case"ResizeW":j=w;E=0-w;break;case"ResizeE":E=w;break;case"ResizeN":case"ResizeNW":case"ResizeNE":if(y=="ResizeNW"){j=w;E=0-w;}else{if(y=="ResizeNE"){E=w;}}m=t;g=0-t;break;case"ResizeS":case"ResizeSW":case"ResizeSE":if(y=="ResizeSW"){j=w;E=0-w;}else{if(y=="ResizeSE"){E=w;}}g=t;break;case"mceMove":j=w;m=t;break;}if(E<(p=q.features.min_width-k.w)){if(j!==0){j+=E-p;}E=p;}if(g<(p=q.features.min_height-k.h)){if(m!==0){m+=g-p;}g=p;}E=Math.min(E,q.features.max_width-k.w);g=Math.min(g,q.features.max_height-k.h);j=Math.max(j,B.x-(A+B.x));m=Math.max(m,B.y-(G+B.y));j=Math.min(j,(B.w+B.x)-(A+k.w+B.x));m=Math.min(m,(B.h+B.y)-(G+k.h+B.y));if(j+m!==0){if(A+j<0){j=0;}if(G+m<0){m=0;}f.moveTo(A+j,G+m);}if(E+g!==0){f.resizeTo(k.w+E,k.h+g);}return b.cancel(H);});return b.cancel(C);},resizeBy:function(f,h,g){var i=this.windows[g];if(i){i.element.resizeBy(f,h);i.iframeElement.resizeBy(f,h);}},close:function(f,g){var j=this,l,i=d.doc,k=0,h,g;g=j._findId(g||f);if(!j.windows[g]){j.parent(f);return;}j.count--;if(j.count==0){d.remove("mceModalBlocker");}if(l=j.windows[g]){j.onClose.dispatch(j);b.remove(i,"mousedown",l.mousedownFunc);b.remove(i,"click",l.clickFunc);b.clear(g);b.clear(g+"_ifr");d.setAttrib(g+"_ifr","src",'javascript:""');l.element.remove();delete j.windows[g];e(j.windows,function(m){if(m.zIndex>k){h=m;k=m.zIndex;}});if(h){j.focus(h.id);}}},setTitle:function(h,f){var g;h=this._findId(h);if(g=d.get(h+"_title")){g.innerHTML=d.encode(f);}},alert:function(i,f,h){var g=this,j;j=g.open({title:g,type:"alert",button_func:function(k){if(f){f.call(k||g,k);}g.close(null,j.id);},content:d.encode(g.editor.getLang(i,i)),inline:1,width:400,height:130});},confirm:function(i,f,h){var g=this,j;j=g.open({title:g,type:"confirm",button_func:function(k){if(f){f.call(k||g,k);}g.close(null,j.id);},content:d.encode(g.editor.getLang(i,i)),inline:1,width:400,height:130});},_findId:function(g){var f=this;if(typeof(g)=="string"){return g;}e(f.windows,function(i){var h=d.get(i.id+"_ifr");if(h&&g==h.contentWindow){g=i.id;return false;}});return g;},_fixIELayout:function(f,g){var i,h;if(!tinymce.isIE6){return;}e(["n","s","w","e","nw","ne","sw","se"],function(k){var j=d.get(f+"_resize_"+k);d.setStyles(j,{width:g?j.clientWidth:"",height:g?j.clientHeight:"",cursor:d.getStyle(j,"cursor",1)});d.setStyle(f+"_bottom","bottom","-1px");j=0;});if(i=this.windows[f]){i.element.hide();i.element.show();e(d.select("div,a",f),function(j,k){if(j.currentStyle.backgroundImage!="none"){h=new Image();h.src=j.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1");}});d.get(f).style.filter="";}}});tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups);})();