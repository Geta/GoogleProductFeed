(function(b,c){var a;b.create("tinymce.plugins.epiimageeditor",{init:function(d,e){d.addCommand("mceEPiImageEditor",function(){if(d.dom.getAttrib(d.selection.getNode(),"class").indexOf("mceItem")!=-1){return;}var k=EPi.ResolveUrlFromUI("Edit/ImageEditor/ImageEditor.aspx?")+c.param(d.settings.epi_page_context);var i=a;var j;var l=function(n,m){if(!n){return;}d.getWin().focus();if(j){d.dom.setAttrib(i,"width",n.actualWidth);d.dom.setAttrib(i,"height",n.actualHeight);}var o=d.dom.getAttrib(i,"src");var p=(new Date()).getTime();var q=(n.src.indexOf("?")<0)?"?":"&";d.dom.setAttrib(i,"src",n.src+q+"epi_image_timestamp="+p);d.undoManager.add();d.windowManager.onClose.dispatch();};var f={width:d.getParam("epiImageEditor_dialogWidth"),height:d.getParam("epiImageEditor_dialogHeight")};var g={};var h=d.dom.getAttrib(i,"src").replace(/(\?|&)epi_image_timestamp=.*/g,"");g.src=h;j=d.dom.getAttrib(i,"width");d.windowManager.onOpen.dispatch();EPi.CreateDialog(k,l,null,g,f);});d.addButton("epiimageeditor",{title:"epiimageeditor.epiimageeditor_desc",cmd:"mceEPiImageEditor","class":"mce_epiimageeditor"});d.onNodeChange.add(function(i,h,g){var f=g.nodeName==="IMG"&&i.dom.getAttrib(g,"class").indexOf("mceItem")===-1;h.setActive("epiimageeditor",f);h.setDisabled("epiimageeditor",!f);a=f?g:null;});d.onPostProcess.add(function(f,g){g.content=g.content.replace(/(\?|&)epi_image_timestamp=.*"/g,'"');});},createControl:function(d,e){return null;},getInfo:function(){return{longname:"EPiServer CMS Image Editor Plug-in",author:"EPiServer AB",authorurl:"http://www.episerver.com",infourl:"http://www.episerver.com",version:"1.0"};}});b.PluginManager.add("epiimageeditor",b.plugins.epiimageeditor);}(tinymce,epiJQuery));