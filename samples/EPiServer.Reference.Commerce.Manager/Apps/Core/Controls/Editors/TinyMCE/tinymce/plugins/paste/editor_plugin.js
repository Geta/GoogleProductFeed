(function(){var d=tinymce.each,b=null,c={paste_auto_cleanup_on_paste:true,paste_block_drop:false,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:false,paste_remove_styles:false,paste_remove_styles_if_webkit:true,paste_convert_middot_lists:true,paste_convert_headers_to_strong:false,paste_dialog_width:"450",paste_dialog_height:"400",paste_text_use_dialog:false,paste_text_sticky:false,paste_text_notifyalways:false,paste_text_linebreaktype:"p",paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};function a(e,f){return e.getParam(f,c[f]);}tinymce.create("tinymce.plugins.PastePlugin",{init:function(i,e){var g=this;g.editor=i;g.url=e;g.onPreProcess=new tinymce.util.Dispatcher(g);g.onPostProcess=new tinymce.util.Dispatcher(g);g.onPreProcess.add(g._preProcess);g.onPostProcess.add(g._postProcess);g.onPreProcess.add(function(j,k){i.execCallback("paste_preprocess",j,k);});g.onPostProcess.add(function(j,k){i.execCallback("paste_postprocess",j,k);});i.pasteAsPlainText=false;function h(j,k){var l=i.dom;g.onPreProcess.dispatch(g,j);j.node=l.create("div",0,j.content);g.onPostProcess.dispatch(g,j);j.content=i.serializer.serialize(j.node,{getInner:1});if((!k)&&(i.pasteAsPlainText)){g._insertPlainText(i,l,j.content);if(!a(i,"paste_text_sticky")){i.pasteAsPlainText=false;i.controlManager.setActive("pastetext",false);}}else{if(/<(p|h[1-6]|ul|ol)/.test(j.content)){g._insertBlockContent(i,l,j.content);}else{g._insert(j.content);}}}i.addCommand("mceInsertClipboardContent",function(j,k){h(k,true);});if(!a(i,"paste_text_use_dialog")){i.addCommand("mcePasteText",function(k,l){var j=tinymce.util.Cookie;i.pasteAsPlainText=!i.pasteAsPlainText;i.controlManager.setActive("pastetext",i.pasteAsPlainText);if((i.pasteAsPlainText)&&(!j.get("tinymcePasteText"))){if(a(i,"paste_text_sticky")){i.windowManager.alert(i.translate("paste.plaintext_mode_sticky"));}else{i.windowManager.alert(i.translate("paste.plaintext_mode_sticky"));}if(!a(i,"paste_text_notifyalways")){j.set("tinymcePasteText","1",new Date(new Date().getFullYear()+1,12,31));}}});}i.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"});i.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"});function f(s){var p,r,k,q=i.selection,o=i.dom,l=i.getBody(),m;if(i.pasteAsPlainText&&(s.clipboardData||o.doc.dataTransfer)){s.preventDefault();h({content:(s.clipboardData||o.doc.dataTransfer).getData("Text").replace(/\r?\n/g,"<br />")});return;}if(o.get("_mcePaste")){return;}p=o.add(l,"div",{id:"_mcePaste","class":"mcePaste"},'\uFEFF<br _mce_bogus="1">');if(l!=i.getDoc().body){m=o.getPos(i.selection.getStart(),l).y;}else{m=l.scrollTop;}o.setStyles(p,{position:"absolute",left:-10000,top:m,width:1,height:1,overflow:"hidden"});if(tinymce.isIE){k=o.doc.body.createTextRange();k.moveToElementText(p);k.execCommand("Paste");o.remove(p);if(p.innerHTML==="\uFEFF"){i.execCommand("mcePasteWord");s.preventDefault();return;}h({content:p.innerHTML});return tinymce.dom.Event.cancel(s);}else{function j(n){n.preventDefault();}o.bind(i.getDoc(),"mousedown",j);o.bind(i.getDoc(),"keydown",j);r=i.selection.getRng();p=p.firstChild;k=i.getDoc().createRange();k.setStart(p,0);k.setEnd(p,1);q.setRng(k);window.setTimeout(function(){var n="",t=o.select("div.mcePaste");d(t,function(u){var v=u.firstChild;if(v&&v.nodeName=="DIV"&&v.style.marginTop&&v.style.backgroundColor){o.remove(v,1);}d(o.select("div.mcePaste",u),function(w){o.remove(w,1);});d(o.select("span.Apple-style-span",u),function(w){o.remove(w,1);});d(o.select("br[_mce_bogus]",u),function(w){o.remove(w);});n+=u.innerHTML;});d(t,function(u){o.remove(u);});if(r){q.setRng(r);}h({content:n});o.unbind(i.getDoc(),"mousedown",j);o.unbind(i.getDoc(),"keydown",j);},0);}}if(a(i,"paste_auto_cleanup_on_paste")){if(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)){i.onKeyDown.add(function(j,k){if(((tinymce.isMac?k.metaKey:k.ctrlKey)&&k.keyCode==86)||(k.shiftKey&&k.keyCode==45)){f(k);}});}else{i.onPaste.addToTop(function(j,k){return f(k);});}}if(a(i,"paste_block_drop")){i.onInit.add(function(){i.dom.bind(i.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(j){j.preventDefault();j.stopPropagation();return false;});});}g._legacySupport();},getInfo:function(){return{longname:"Paste text/word",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste",version:tinymce.majorVersion+"."+tinymce.minorVersion};},_preProcess:function(k,l){var g=this.editor,e=l.content,f=tinymce.grep,i=tinymce.explode,q=tinymce.trim,p,j;function n(h){d(h,function(o){if(o.constructor==RegExp){e=e.replace(o,"");}else{e=e.replace(o[0],o[1]);}});}if(/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(e)||l.wordContent){l.wordContent=true;n([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]);if(a(g,"paste_convert_headers_to_strong")){e=e.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>");}if(a(g,"paste_convert_middot_lists")){n([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"]]);}n([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,"\u00a0"]]);do{p=e.length;e=e.replace(/(<[a-z][^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1");}while(p!=e.length);if(a(g,"paste_retain_style_properties").replace(/^none$/i,"").length==0){e=e.replace(/<\/?span[^>]*>/gi,"");}else{n([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(h,o){return(o.length>0)?o.replace(/./," ").slice(Math.floor(o.length/2)).split("").join("\u00a0"):"";}],[/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(u,t,h){var r=[],o=0,v=i(q(h).replace(/&quot;/gi,"'"),";");d(v,function(y){var z,s,w=i(y,":");function x(A){return A+((A!=="0")&&(/\d$/.test(A)))?"px":"";}if(w.length==2){z=w[0].toLowerCase();s=w[1].toLowerCase();switch(z){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":r[o++]=z.replace(/^mso-|-alt$/g,"")+":"+x(s);return;case"horiz-align":r[o++]="text-align:"+s;return;case"vert-align":r[o++]="vertical-align:"+s;return;case"font-color":case"mso-foreground":r[o++]="color:"+s;return;case"mso-background":case"mso-highlight":r[o++]="background:"+s;return;case"mso-default-height":r[o++]="min-height:"+x(s);return;case"mso-default-width":r[o++]="min-width:"+x(s);return;case"mso-padding-between-alt":r[o++]="border-collapse:separate;border-spacing:"+x(s);return;case"text-line-through":if((s=="single")||(s=="double")){r[o++]="text-decoration:line-through";}return;case"mso-zero-height":if(s=="yes"){r[o++]="display:none";}return;}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(z)){return;}r[o++]=z+":"+w[1];}});if(o>0){return t+' style="'+r.join(";")+'"';}else{return t;}}]]);}}if(a(g,"paste_convert_headers_to_strong")){n([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]]);}j=a(g,"paste_strip_class_attributes");if(j!=="none"){function m(r,h){if(j==="all"){return"";}var o=f(i(h.replace(/^(["'])(.*)\1$/,"$2")," "),function(s){return(/^(?!mso)/i.test(s));});return o.length?' class="'+o.join(" ")+'"':"";}e=e.replace(/ class="([^"]+)"/gi,m);e=e.replace(/ class=(\w+)/gi,m);}if(a(g,"paste_remove_spans")){e=e.replace(/<\/?span[^>]*>/gi,"");}l.content=e;},_postProcess:function(g,h){var i=this,e=i.editor,f=e.dom,j;if(h.wordContent){d(f.select("a",h.node),function(k){if(!k.href||k.href.indexOf("#_Toc")!=-1){f.remove(k,1);}});if(a(e,"paste_convert_middot_lists")){i._convertLists(g,h);}j=a(e,"paste_retain_style_properties");if((tinymce.is(j,"string"))&&(j!=="all")&&(j!=="*")){j=tinymce.explode(j.replace(/^none$/i,""));d(f.select("*",h.node),function(n){var o={},m=0,k,p,l;if(j){for(k=0;k<j.length;k++){p=j[k];l=f.getStyle(n,p);if(l){o[p]=l;m++;}}}f.setAttrib(n,"style","");if(j&&m>0){f.setStyles(n,o);}else{if(n.nodeName=="SPAN"&&!n.className){f.remove(n,true);}}});}}if(a(e,"paste_remove_styles")||(a(e,"paste_remove_styles_if_webkit")&&tinymce.isWebKit)){d(f.select("*[style]",h.node),function(k){k.removeAttribute("style");k.removeAttribute("_mce_style");});}else{if(tinymce.isWebKit){d(f.select("*",h.node),function(k){k.removeAttribute("_mce_style");});}}},_convertLists:function(i,j){var g=i.editor.dom,m,n,f=-1,k,l=[],e,h;d(g.select("p",j.node),function(s){var u,q="",t,o,v,r;for(u=s.firstChild;u&&u.nodeType==3;u=u.nextSibling){q+=u.nodeValue;}q=s.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,"\u00a0");if(/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o]\s*\u00a0*/.test(q)){t="ul";}if(/^__MCE_ITEM__\s*\w+\.\s*\u00a0{2,}/.test(q)){t="ol";}if(t){k=parseFloat(s.style.marginLeft||0);if(k>f){l.push(k);}if(!m||t!=e){m=g.create(t);g.insertAfter(m,s);}else{if(k>f){m=n.appendChild(g.create(t));}else{if(k<f){v=tinymce.inArray(l,k);r=g.getParents(m.parentNode,t);m=r[r.length-1-v]||m;}}}d(g.select("span",s),function(p){var w=p.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");if(t=="ul"&&/^[\u2022\u00b7\u00a7\u00d8o]/.test(w)){g.remove(p);}else{if(/^[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(w)){g.remove(p);}}});o=s.innerHTML;if(t=="ul"){o=s.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o]\s*(&nbsp;|\u00a0)+\s*/,"");}else{o=s.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,"");}n=m.appendChild(g.create("li",0,o));g.remove(s);f=k;e=t;}else{m=f=0;}});h=j.node.innerHTML;if(h.indexOf("__MCE_ITEM__")!=-1){j.node.innerHTML=h.replace(/__MCE_ITEM__/g,"");}},_insertBlockContent:function(e,k,l){var j,n,i=e.selection,p,q,g,f,h,o="mce_marker";function m(s){var t;if(tinymce.isIE){t=e.getDoc().body.createTextRange();t.moveToElementText(s);t.collapse(false);t.select();}else{i.select(s,1);i.collapse(false);}}this._insert('<span id="'+o+'"></span>',1);n=k.get(o);j=k.getParent(n,"p,h1,h2,h3,h4,h5,h6,ul,ol,th,td");if(j&&!/TD|TH/.test(j.nodeName)){n=k.split(j,n);d(k.create("div",0,l).childNodes,function(r){p=n.parentNode.insertBefore(r.cloneNode(true),n);});m(p);}else{k.setOuterHTML(n,l);i.select(e.getBody(),1);i.collapse(0);}while(q=k.get(o)){k.remove(q);}q=i.getStart();g=k.getViewPort(e.getWin());f=e.dom.getPos(q).y;h=q.clientHeight;if(f<g.y||f+h>g.y+g.h){e.getDoc().body.scrollTop=f<g.y?f:f-g.h+25;}},_insert:function(e,i){var g=this.editor,f=g.selection.getRng();if(!g.selection.isCollapsed()&&f.startContainer!=f.endContainer){g.getDoc().execCommand("Delete",false,null);}g.execCommand(tinymce.isGecko?"insertHTML":"mceInsertContent",false,e,{skip_undo:i});},_insertPlainText:function(y,s,p){var f,l,k,z,g,e,q,m,o=y.getWin(),v=y.getDoc(),j=y.selection,r=tinymce.is,x=tinymce.inArray,t=a(y,"paste_text_linebreaktype"),n=a(y,"paste_text_replacements");function u(h){d(h,function(i){if(i.constructor==RegExp){p=p.replace(i,"");}else{p=p.replace(i[0],i[1]);}});}if((typeof(p)==="string")&&(p.length>0)){if(!b){b=("34,quot,38,amp,39,apos,60,lt,62,gt,"+y.serializer.settings.entities).split(",");}if(/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(p)){u([/[\n\r]+/g]);}else{u([/\r+/g]);}u([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"\t"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/&(#\d+|[a-z0-9]{1,10});/gi,function(h,i){if(i.charAt(0)==="#"){return String.fromCharCode(i.slice(1));}else{return((h=x(b,i))>0)?String.fromCharCode(b[h-1]):" ";}}],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"],[/\n{3,}/g,"\n\n"],/^\s+|\s+$/g]);p=s.encode(p);if(!j.isCollapsed()){v.execCommand("Delete",false,null);}if(r(n,"array")||(r(n,"array"))){u(n);}else{if(r(n,"string")){u(new RegExp(n,"gi"));}}if(t=="none"){u([[/\n+/g," "]]);}else{if(t=="br"){u([[/\n/g,"<br />"]]);}else{u([/^\s+|\s+$/g,[/\n\n/g,"</p><p>"],[/\n/g,"<br />"]]);}}if((k=p.indexOf("</p><p>"))!=-1){z=p.lastIndexOf("</p><p>");g=j.getNode();e=[];do{if(g.nodeType==1){if(g.nodeName=="TD"||g.nodeName=="BODY"){break;}e[e.length]=g;}}while(g=g.parentNode);if(e.length>0){q=p.substring(0,k);m="";for(f=0,l=e.length;f<l;f++){q+="</"+e[f].nodeName.toLowerCase()+">";m+="<"+e[e.length-f-1].nodeName.toLowerCase()+">";}if(k==z){p=q+m+p.substring(k+7);}else{p=q+p.substring(k+4,z+4)+m+p.substring(z+7);}}}y.execCommand("mceInsertRawHTML",false,p+'<span id="_plain_text_marker">&nbsp;</span>');window.setTimeout(function(){var w=s.get("_plain_text_marker"),i,h,B,A;j.select(w,false);v.execCommand("Delete",false,null);w=null;i=j.getStart();h=s.getViewPort(o);B=s.getPos(i).y;A=i.clientHeight;if((B<h.y)||(B+A>h.y+h.h)){v.body.scrollTop=B<h.y?B:B-h.h+25;}},0);}},_legacySupport:function(){var f=this,e=f.editor;e.addCommand("mcePasteWord",function(){e.windowManager.open({file:f.url+"/pasteword.htm",width:parseInt(a(e,"paste_dialog_width")),height:parseInt(a(e,"paste_dialog_height")),inline:1});});if(a(e,"paste_text_use_dialog")){e.addCommand("mcePasteText",function(){e.windowManager.open({file:f.url+"/pastetext.htm",width:parseInt(a(e,"paste_dialog_width")),height:parseInt(a(e,"paste_dialog_height")),inline:1});});}e.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"});}});tinymce.PluginManager.add("paste",tinymce.plugins.PastePlugin);})();