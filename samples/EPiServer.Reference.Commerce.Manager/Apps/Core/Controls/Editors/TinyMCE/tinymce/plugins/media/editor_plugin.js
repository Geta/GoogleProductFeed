(function(){var a=tinymce.each;tinymce.create("tinymce.plugins.MediaPlugin",{init:function(f,b){var c=this;c.editor=f;c.url=b;function e(g){return/^(mceItemFlash|mceItemShockWave|mceItemWindowsMedia|mceItemQuickTime|mceItemRealMedia)$/.test(g.className);}f.onPreInit.add(function(){f.serializer.addRules("param[name|value|_mce_value]");});f.addCommand("mceMedia",function(){f.windowManager.open({file:b+"/media.htm",width:430+parseInt(f.getLang("media.delta_width",0)),height:470+parseInt(f.getLang("media.delta_height",0)),inline:1},{plugin_url:b});});f.addButton("media",{title:"media.desc",cmd:"mceMedia"});f.onNodeChange.add(function(i,h,g){h.setActive("media",g.nodeName=="IMG"&&e(g));});f.onInit.add(function(){var g={mceItemFlash:"flash",mceItemShockWave:"shockwave",mceItemWindowsMedia:"windowsmedia",mceItemQuickTime:"quicktime",mceItemRealMedia:"realmedia"};f.selection.onSetContent.add(function(){c._spansToImgs(f.getBody());});f.selection.onBeforeSetContent.add(c._objectsToSpans,c);if(f.settings.content_css!==false){f.dom.loadCSS(b+"/css/content.css");}if(f.theme&&f.theme.onResolveName){f.theme.onResolveName.add(function(h,i){if(i.name=="img"){a(g,function(l,j){if(f.dom.hasClass(i.node,j)){i.name=l;i.title=f.dom.getAttrib(i.node,"title");return false;}});}});}if(f&&f.plugins.contextmenu){f.plugins.contextmenu.onContextMenu.add(function(h,i,j){if(j.nodeName=="IMG"&&/mceItem(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)/.test(j.className)){i.add({title:"media.edit",icon:"media",cmd:"mceMedia"});}});}});f.onBeforeSetContent.add(c._objectsToSpans,c);f.onSetContent.add(function(){c._spansToImgs(f.getBody());});f.onPreProcess.add(function(i,g){var h=i.dom;if(g.set){c._spansToImgs(g.node);a(h.select("IMG",g.node),function(j){var k;if(e(j)){k=c._parse(j.title);h.setAttrib(j,"width",h.getAttrib(j,"width",k.width||100));h.setAttrib(j,"height",h.getAttrib(j,"height",k.height||100));}});}if(g.get){a(h.select("IMG",g.node),function(m){var l,j,k;if(i.getParam("media_use_script")){if(e(m)){m.className=m.className.replace(/mceItem/g,"mceTemp");}return;}switch(m.className){case"mceItemFlash":l="d27cdb6e-ae6d-11cf-96b8-444553540000";j="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0";k="application/x-shockwave-flash";break;case"mceItemShockWave":l="166b1bca-3f9c-11cf-8075-444553540000";j="http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0";k="application/x-director";break;case"mceItemWindowsMedia":l=i.getParam("media_wmp6_compatible")?"05589fa1-c356-11ce-bf01-00aa0055595a":"6bf52a52-394a-11d3-b153-00c04f79faa6";j="http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701";k="application/x-mplayer2";break;case"mceItemQuickTime":l="02bf25d5-8c17-4b23-bc80-d3488abddc6b";j="http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0";k="video/quicktime";break;case"mceItemRealMedia":l="cfcdaa03-8be4-11cf-b84b-0020afbbccfa";j="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0";k="audio/x-pn-realaudio-plugin";break;}if(l){h.replace(c._buildObj({classid:l,codebase:j,type:k},m),m);}});}});f.onPostProcess.add(function(g,h){h.content=h.content.replace(/_mce_value=/g,"value=");});function d(h,g){g=new RegExp(g+'="([^"]+)"',"g").exec(h);return g?f.dom.decode(g[1]):"";}f.onPostProcess.add(function(g,h){if(g.getParam("media_use_script")){h.content=h.content.replace(/<img[^>]+>/g,function(j){var i=d(j,"class");if(/^(mceTempFlash|mceTempShockWave|mceTempWindowsMedia|mceTempQuickTime|mceTempRealMedia)$/.test(i)){at=c._parse(d(j,"title"));at.width=d(j,"width");at.height=d(j,"height");j='<script type="text/javascript">write'+i.substring(7)+"({"+c._serialize(at)+"});</script>";}return j;});}});},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion};},_objectsToSpans:function(e,b){var c=this,d=b.content;d=d.replace(/<script[^>]*>\s*write(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)\(\{([^\)]*)\}\);\s*<\/script>/gi,function(g,h,i){var f=c._parse(i);return'<img class="mceItem'+h+'" title="'+e.dom.encode(i)+'" src="'+c.url+'/img/trans.gif" width="'+f.width+'" height="'+f.height+'" />';});d=d.replace(/<object([^>]*)>/gi,'<span class="mceItemObject" $1>');d=d.replace(/<embed([^>]*)\/?>/gi,'<span class="mceItemEmbed" $1></span>');d=d.replace(/<embed([^>]*)>/gi,'<span class="mceItemEmbed" $1>');d=d.replace(/<\/(object)([^>]*)>/gi,"</span>");d=d.replace(/<\/embed>/gi,"");d=d.replace(/<param([^>]*)>/gi,function(f,g){return"<span "+g.replace(/value=/gi,"_mce_value=")+' class="mceItemParam"></span>';});d=d.replace(/\/ class=\"mceItemParam\"><\/span>/gi,'class="mceItemParam"></span>');b.content=d;},_buildObj:function(e,d){var g,b=this.editor,c=b.dom,f=this._parse(d.title),h;h=b.getParam("media_strict",true)&&e.type=="application/x-shockwave-flash";f.width=e.width=c.getAttrib(d,"width")||100;f.height=e.height=c.getAttrib(d,"height")||100;if(f.src){f.src=b.convertURL(f.src,"src",d);}if(h){g=c.create("span",{id:f.id,_mce_name:"object",type:"application/x-shockwave-flash",data:f.src,style:c.getAttrib(d,"style"),width:e.width,height:e.height});}else{g=c.create("span",{id:f.id,_mce_name:"object",classid:"clsid:"+e.classid,style:c.getAttrib(d,"style"),codebase:e.codebase,width:e.width,height:e.height});}a(f,function(j,i){if(!/^(width|height|codebase|classid|id|_cx|_cy)$/.test(i)){if(e.type=="application/x-mplayer2"&&i=="src"&&!f.url){i="url";}if(j){c.add(g,"span",{_mce_name:"param",name:i,_mce_value:j});}}});if(!h){c.add(g,"span",tinymce.extend({_mce_name:"embed",type:e.type,style:c.getAttrib(d,"style")},f));}return g;},_spansToImgs:function(f){var e=this,c=e.editor.dom,d,b;a(c.select("span",f),function(g){if(c.getAttrib(g,"class")=="mceItemObject"){b=c.getAttrib(g,"classid").toLowerCase().replace(/\s+/g,"");switch(b){case"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000":c.replace(e._createImg("mceItemFlash",g),g);break;case"clsid:166b1bca-3f9c-11cf-8075-444553540000":c.replace(e._createImg("mceItemShockWave",g),g);break;case"clsid:6bf52a52-394a-11d3-b153-00c04f79faa6":case"clsid:22d6f312-b0f6-11d0-94ab-0080c74c7e95":case"clsid:05589fa1-c356-11ce-bf01-00aa0055595a":c.replace(e._createImg("mceItemWindowsMedia",g),g);break;case"clsid:02bf25d5-8c17-4b23-bc80-d3488abddc6b":c.replace(e._createImg("mceItemQuickTime",g),g);break;case"clsid:cfcdaa03-8be4-11cf-b84b-0020afbbccfa":c.replace(e._createImg("mceItemRealMedia",g),g);break;default:c.replace(e._createImg("mceItemFlash",g),g);}return;}if(c.getAttrib(g,"class")=="mceItemEmbed"){switch(c.getAttrib(g,"type")){case"application/x-shockwave-flash":c.replace(e._createImg("mceItemFlash",g),g);break;case"application/x-director":c.replace(e._createImg("mceItemShockWave",g),g);break;case"application/x-mplayer2":c.replace(e._createImg("mceItemWindowsMedia",g),g);break;case"video/quicktime":c.replace(e._createImg("mceItemQuickTime",g),g);break;case"audio/x-pn-realaudio-plugin":c.replace(e._createImg("mceItemRealMedia",g),g);break;default:c.replace(e._createImg("mceItemFlash",g),g);}}});},_createImg:function(f,d){var b,c=this.editor.dom,g={},e="",h;h=["id","name","width","height","bgcolor","align","flashvars","src","wmode","allowfullscreen","quality","data"];b=c.create("img",{src:this.url+"/img/trans.gif",width:c.getAttrib(d,"width")||100,height:c.getAttrib(d,"height")||100,style:c.getAttrib(d,"style"),"class":f});a(h,function(j){var i=c.getAttrib(d,j);if(i){g[j]=i;}});a(c.select("span",d),function(i){if(c.hasClass(i,"mceItemParam")){g[c.getAttrib(i,"name")]=c.getAttrib(i,"_mce_value");}});if(g.movie){g.src=g.movie;delete g.movie;}if(!g.src){g.src=g.data;delete g.data;}d=c.select(".mceItemEmbed",d)[0];if(d){a(h,function(j){var i=c.getAttrib(d,j);if(i&&!g[j]){g[j]=i;}});}delete g.width;delete g.height;b.title=this._serialize(g);return b;},_parse:function(b){return tinymce.util.JSON.parse("{"+b+"}");},_serialize:function(b){return tinymce.util.JSON.serialize(b).replace(/[{}]/g,"");}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin);})();